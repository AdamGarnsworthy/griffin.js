<html> 
  <head>

    <link href='http://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

    <script src="zepto.min.js" type="text/javascript"></script>
    <script src="utilities.js" type="text/javascript"></script>
    <script src="branding.js" type="text/javascript"></script>
    <script src="Waffle.js" type="text/javascript"></script>
    <script src="tooltip.js" type="text/javascript"></script>
    <script src="alarmSidebar.js" type="text/javascript"></script>
    <script src="formHandler.js" type="text/javascript"></script>
    <script src="slider.js" type="text/javascript"></script>
    <script src="fillMeter.js" type="text/javascript"></script>
    <script src="BarGraph.js" type="text/javascript"></script>
    <script src="masterControl.js" type="text/javascript"></script>
    <script src="viewTransitions.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="scalarDashboard.css" />
    <link rel="stylesheet" type="text/css" href="slider.css" />
  </head> 


  <body style="font-family: 'Raleway', sans-serif;"> 

    <!--Branding///////////////////////////////////////////////////////////-->
    <canvas id="banner"></canvas>

    <!--Buttons////////////////////////////////////////////////////////////-->
    <div id="navBar">
      <!--form action="demo.html" style='display:inline; position:relative; left:1%;'>
        <input type="submit" value="Dashboard">
      </form>
      <button type="button" style='position:relative; left:1%;'>Trigger</button>
      <button type="button" style='position:relative; left:1%;'>Monitoring</button>
      <button type="button" style='position:relative; left:1%;'>ELog</button-->
      <p id="youAreHere" style='display: inline; color:rgba(0,0,0,0.2); font-size:24px; position:absolute; margin:0'></p>
    </div>

    <!--Waffleboard////////////////////////////////////////////////////////-->

    <div id="waffleplate">

      <!--Alarm Layer//////////////////////////////////////////////////////-->
      <div id='alarmLayer' style='float:left'>
        <canvas id="leftSidebar"></canvas>

        <div class='alarmDiv' id='voltAlarm' onclick="javascript:alarmTransition('voltAlarm', 0)">
          <canvas id='alarmIconV', style='position:absolute; height:150px'></canvas>
          <p id='voltageText', style='color:white; margin-left:50px; margin-right:30px; position:relative; top:150px'></p>
        </div>

        <div class='alarmDiv' id='currentAlarm' onclick="javascript:alarmTransition('currentAlarm', 170)">
          <canvas id='alarmIconI', style='position:absolute; height:150px'></canvas>
          <p id='currentText', style='color:white; margin-left:50px; margin-right:30px; position:relative; top:150px'></p>
        </div>

        <div class='alarmDiv' id='tempAlarm' onclick="javascript:alarmTransition('tempAlarm', 340)">
          <canvas id='alarmIconT', style='position:absolute; height:150px'></canvas>
          <p id='temperatureText', style='color:white; margin-left:50px; margin-right:30px; position:relative; top:150px'></p>
        </div>
      </div>

      <!---Waffle/////////////////////////////////////////////////////////-->
      <div id="mainframeLinks">
        <!--h1  style='display: inline; opacity: 0.3; font-family: "Orbitron", sans-serif; font-size: 275%; vertical-align:-20px;'>GRIFFIN HV Mainframe 1</h1-->
        <h1  style='display: inline; opacity: 0.3; font-family: "Orbitron", sans-serif; font-size: 275%; vertical-align:-20px;'>GRIFFIN HV Mainframe 1</h1>
        <br><button id='Main1' class='MFlink' type="button" style='background:-webkit-gradient(linear, left top, left bottom, from(#999999), to(#DDDDDD))' onclick="javascript:swapFade('TestWaffle', 'Main1')">Mainframe 1</button>
        <button id='Main2' class='MFlink' type="button">Mainframe 2</button>
        <button id='Main3' class='MFlink' type="button">Mainframe 3</button>

        <br><button id='card0' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar0', 'card0')">Card<br>0</button>
        <button id='card1' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar1', 'card1')">Card 1</button>
        <button id='card2' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar2', 'card2')">Card 2</button>
        <button id='card3' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar3', 'card3')">Card<br>3</button>
        <button id='card4' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar0', 'card4')">Card<br>0</button>
        <button id='card5' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar1', 'card5')">Card 1</button>
        <button id='card6' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar2', 'card6')">Card 2</button>
        <button id='card7' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar3', 'card7')">Card<br>3</button>

      </div>
      <canvas id="TestWaffle"></canvas>
      <canvas id='bar0' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='bar1' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='bar2' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='bar3' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>

      <!--Input Layer//////////////////////////////////////////////////////-->
      <div align='left' id='InputLayer'>

        <canvas id='rightSidebar'></canvas>

        <!--title-->
        <h2 id='inputTitle' align='left' style='margin-left:10%; font-family: "Orbitron", sans-serif;'>sintitulo</h2>

        <!--Form for channel reporting and input-->
        <form id='setValues'>
          <!--Channel on off & status:-->
          <input type='radio' id='offButton' name='HVswitch' value='off' style='margin-left:10%; margin-bottom:10px'>Off
          <input type='radio' id='onButton' name='HVswitch' value='on' style='margin-left:10px; margin-bottom:10px'>On

          <!--status:-->
          <p id='status' style='margin-left:10%;'>Status:</p>

          <!--voltage fill meter-->
          <p style='margin-left:10%; margin-bottom:0px; display:inline; position:relative; top:-18px;'>Voltage [V]</p>
          <canvas id='voltageMeter' style='margin-left:2%;'></canvas>

          <!--current fill meter-->
          <p style='margin-left:10%; margin-bottom:0px; display:inline; position:relative; top:-18px;'>Current [mA]</p>
          <canvas id='currentMeter' style='margin-left:2%;'></canvas>

          <!--temperature fill meter-->
          <p style='margin-left:10%; margin-bottom:0px; display:inline; position:relative; top:-18px;'>Temperature [C]</p>
          <canvas id='temperatureMeter' style='margin-left:2%;'></canvas>

          <!--Demand voltage input field-->
          <p id='FieldText' style='margin-left:10%'>Demand Voltage [V]</p>
          <input type="text" id="demandVoltage" name='textbox' value='default' style='margin-bottom:10px; margin-top: 5px; margin-left:10%' size='6'>

          <!--Slider for demand voltage-->
          <div class='slider' id='voltageSlider'>
            <canvas class='sliderBKG' id='voltageSliderBKG' width=260 height=24></canvas>
            <div class='sliderKnob' id='voltageSliderKnob'>
              <canvas class='knobStyle' id='voltageKnobStyle' width=24 height=16> </canvas>
              <p class='sliderText' id='voltageSliderText'><br>0%</p>
            </div>
          </div>

          <!--voltage ramp up speed input field-->
          <p id='RampText' style='margin:0px; margin-left:10%; margin-top:20px'>Voltage Ramp Up Speed [V/s]</p>
          <input type="text" id="demandRampSpeed" name='textbox' value='default' style='margin-bottom:10px; margin-top: 5px; margin-left:10%' size='6'>

          <!--Slider for voltage ramp up speed-->
          <div class='slider' id='rampSlider'>
            <canvas class='sliderBKG' id='rampSliderBKG' width=260 height=24></canvas>
            <div class='sliderKnob' id='rampSliderKnob'>
              <canvas class='knobStyle' id='rampKnobStyle' width=24 height=16> </canvas>
              <p class='sliderText' id='rampSliderText'><br>0%</p>
            </div>
          </div>

          <!--voltage ramp down speed input field-->
          <p id='RampTextDown' style='margin:0px; margin-left:10%; margin-top:20px'>Voltage Ramp Down Speed [V/s]</p>
          <input type="text" id="demandRampDownSpeed" name='textbox' value='default' style='margin-bottom:30px; margin-top: 5px; margin-left:10%' size='6'>

          <!--Slider for voltage ramp down speed-->
          <div class='slider' id='rampDownSlider'>
            <canvas class='sliderBKG' id='rampDownSliderBKG' width=260 height=24></canvas>
            <div class='sliderKnob' id='rampDownSliderKnob'>
              <canvas class='knobStyle' id='rampDownKnobStyle' width=24 height=16> </canvas>
              <p class='sliderText' id='rampDownSliderText'><br>0%</p>
            </div>
          </div>

          <!--Submit updates to channel settings-->
          <br><input type="button" value="Submit" style='margin-left:10%' onclick="javascript:updateParameter()">
        </form>

        <canvas id='inputSpacer' height=5px width=200px style='margin-left:10%'></canvas>
        <script type="text/JavaScript">
          //style the input layer a bit:  TODO: factor out?
          var ILcanvas = document.getElementById('inputSpacer');
          var ILcontext = ILcanvas.getContext('2d');
          ILcontext.strokeStyle = 'rgba(255,255,255,0.9)'
          ILcontext.beginPath();
          ILcontext.moveTo(0,0);
          ILcontext.lineTo(200,0);
          ILcontext.stroke();
        </script>

        <!--Form for channel selecting-->
        <form id='changeChannel'>
          <h4 style='margin-left:10%; margin-bottom:10px;'>Change Channel:</h4>
          <p style='display:inline; margin-left:10%'>Card</p>
          <!--input type="text" id="newCol" name='newCol' style='margin-bottom:10px; margin-left:5px; display:inline;' size='6' value='0'-->
          <select id='CardList' style='width:80px;'> </select>
          <p style='display:inline; margin-left:10%'><br>Channel</p>
          <!--input type="text" id="newRow" name='newRow' style='margin-bottom:10px; margin-left:5px; display:inline;' size='6' value='0'-->
          <select id='ChannelList' style='width:75px;'> </select>
          <br><input type="button" value="Go To Channel" style='margin-left:10%; margin-top:10px;' id='getChannelButton'>       
        </form>

      </div>

    </div>
  <!--End Waffleboard////////////////////////////////////////////////////-->

  <!--Tool tip layer/////////////////////////////////////////////////////-->
  <div id="TTcontainer" style="z-index:20000">
    <div id="TT">
      <p id="TipText"></p>
    </div>
  </div>

  <script type="text/JavaScript">

      //--------------Experiment-specific Parameters Here--------------------------------------------------
      //---------------------------------------------------------------------------------------------------
 
      var ODBkeys = ['/Location/Of/Device/Varibles', '/Location/Of/Device/Settings', 'Demand Voltage Key', 'Measured Voltage Key', 'Measured Current Key', 'Voltage Ramp Up Key', 'Voltage Ramp Down Key', 'Temperature Key', 'ChState Key', 'ChStatus Key', 'Voltage Limit Key'];

      //cell labels; first entry decribes cell type
      var rowTitles = ['Ch.', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'];

      //module edges and names:
      var moduleSizes = [1,4,4,1,1,4,4,1];
      var moduleLabels = ['Card 0', 'Card 1', 'Card 2', 'Card 3', 'Card 0', 'Card 1', 'Card 2', 'Card 3'];

      //alarm thresholds [voltage, current, temperature]:
      var alarmThresholds = [0.8,0.999,0.999];

      //scale maxima [voltage, current, temperature]:
      var scaleMaxima = [1,1,1];

      //rows & columns:
      var rows = 12;
      var columns = 20;

      //tooltip info prefixes & postfixes:
      var prefix = ['Demand Voltage: ', 'Reported Voltage: ', 'Reported Current: ', 'Voltage Ramp Up Speed: ', 'Voltage Ramp Down Speed', 'Temperature: ', 'Status: '];
      var postfix = ['V', 'V', 'A', 'V/s', 'V/s', 'C', ''];

      //demand voltage range:
      var minVoltage = 0;
      var maxVoltage = 1;

      //current meter range:
      var minCurrent = 0;
      var maxCurrent = 1;

      //voltage ramp speed range:
      var minRampSpeed = 0;
      var maxRampSpeed = 1;

      //number of decimal places to keep on the sliders:
      var sliderPrecision = 3;
      //number of decimal places to keep on the bar chart y-axis:
      var barChartPrecision = 1;

      //voltage unit:
      var voltUnit = 'V';
      //ramp speed unit:
      var rampUnit = 'V/s';
      //current unit:
      var currentUnit = 'A';
      //temperature unit:
      var temperatureUnit = 'C';

      //channel titles for barchart view:
      var smallCard = [0,1,2,3,4,5,6,7,8,9,10,11];
      var bigCard = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47];


      //---------------End Experiment-specific parameters--------------------------------------------------
      //---------------------------------------------------------------------------------------------------

      var i,j;

      //Insert branding & navigation
      Banner('banner', 'youAreHere', 'navBar', 'GRIFFIN HV Mainframe 1');

      //set up wrapper div dimensions; minimum rendering width = 1440px, height 900px:
      var renderWidth = Math.max(1440, window.innerWidth);
      var renderHeight = Math.max(900*0.9,window.innerHeight*0.9)
      $('#waffleplate').width(renderWidth);
      $('#waffleplate').height(window.innerHeight*0.9);
      //$('#waffleplate').width(renderHeight);

      //Waffle onclick event will throw x and y positions up to these globals, so that
      //updateParameter() can use them to determine which channel to update.  TODO: fix
      //without globals.
      window.griffinDialogX;
      window.griffinDialogY;

      //set up channel navigation dropdowns:
      configureDropdowns('ChannelList', 'CardList', moduleLabels);
      document.getElementById('CardList').onblur = function(event){reconfigureChannelList(moduleLabels, moduleSizes, 'ChannelList')};

      //declare objects:
      var sliderWidth = parseFloat($(document.getElementById('InputLayer')).width()) - 150;
      var sliderVoltage = new Slider('volageSliderText', 'demandVoltage', 'voltageSlider', 'voltageSliderBKG', 'voltageSliderKnob', 'voltageKnobStyle', 'voltageSliderText', minVoltage, maxVoltage, sliderPrecision, voltUnit, sliderWidth );
      var sliderRamp = new Slider('rampSliderText', 'demandRampSpeed', 'rampSlider', 'rampSliderBKG', 'rampSliderKnob', 'rampKnobStyle', 'rampSliderText', minRampSpeed, maxRampSpeed, sliderPrecision, rampUnit,  sliderWidth);
      var sliderRampDown = new Slider('rampDownSliderText', 'demandRampDownSpeed', 'rampDownSlider', 'rampDownSliderBKG', 'rampDownSliderKnob', 'rampDownKnobStyle', 'rampDownSliderText', minRampSpeed, maxRampSpeed, sliderPrecision, rampUnit,  sliderWidth);

      var meter = new FillMeter('voltageMeter', 0.7*sliderWidth, minVoltage, maxVoltage, voltUnit);
      var currentMeter = new FillMeter('currentMeter', 0.6*sliderWidth, minCurrent, maxCurrent, currentUnit);
      var temperatureMeter = new FillMeter('temperatureMeter', 0.6*sliderWidth, minCurrent, maxCurrent, temperatureUnit);

      var waffle = new Waffle(rows,columns, 'TestWaffle', alarmThresholds, scaleMaxima, ['leftSidebar', 'rightSidebar'], "waffleplate", rowTitles, "InputLayer", ODBkeys, ['voltAlarm', 'currentAlarm', 'tempAlarm'], ['alarmIconV', 'alarmIconI', 'alarmIconT'],  'mainframeLinks', moduleSizes, moduleLabels, sliderVoltage, sliderRamp, sliderRampDown);

      var barCharts = [];
      barCharts[0] = new BarGraph('bar0', 0, 12, 'Module 0', 'Reported Voltage [V]', smallCard, minVoltage, maxVoltage, barChartPrecision, waffle);
      barCharts[1] = new BarGraph('bar1', 1,  48, 'Module 1', 'Reported Voltage [V]', bigCard, minVoltage, maxVoltage, barChartPrecision, waffle);
      barCharts[2] = new BarGraph('bar2', 2,  48, 'Module 2', 'Reported Voltage [V]', bigCard, minVoltage, maxVoltage, barChartPrecision, waffle);
      barCharts[3] = new BarGraph('bar3', 3,  12, 'Module 3', 'Reported Voltage [V]', smallCard, minVoltage, maxVoltage, barChartPrecision, waffle);

      var tooltip = new Tooltip(waffle, 'TestWaffle', 'TipText', 'TT', 'TTcontainer', 'waffleplate', prefix, postfix);
      

      //set up arrays:
      var demandVoltage, reportVoltage, reportCurrent, demandVrampUp, demandVrampDown, reportTemperature, channelMask, alarmStatus, rampStatus, voltLimit;
      demandVoltage = [];
      reportVoltage = [];
      reportCurrent = [];
      demandVrampUp = [];
      demandVrampDown = [];
      reportTemperature = [];
      channelMask = [];
      alarmStatus = [];
      rampStatus = [];
      voltLimit = [];
      for(i=0; i<rows+1; i++){
        demandVoltage[i] = [];
        reportVoltage[i] = [];
        reportCurrent[i] = [];
        demandVrampUp[i] = [];
        demandVrampDown[i] = [];
        reportTemperature[i] = [];
        channelMask[i] = [];
        alarmStatus[i] = [];
        rampStatus[i] = [];
        voltLimit[i] = [];
        for(j=0;j<columns;j++){
          alarmStatus[i][j] = [];
        }
      }


      //which canvas is on top?
      window.onDisplay = 'TestWaffle';
      //which was the last nav button pushed?
      window.lastTrip = 'Main1';
      //should the input sidebar be refreshed?
      window.refreshInput = 1;
      //something to hold the settimeout loop so it can be stopped from anywhere:
      window.loop;

      function startLoop(){
        masterLoop(rows+1, columns, moduleSizes, ODBkeys, demandVoltage, reportVoltage, reportCurrent, demandVrampUp, demandVrampDown, reportTemperature, channelMask, alarmStatus, rampStatus, voltLimit, alarmThresholds, scaleMaxima, waffle, barCharts, tooltip, 0);
      }
      startLoop();

  </script> 
  
  </body>
 
</html>
