<html> 
  <head>

    <link rel="icon" type="image/png" href="favicon.png" />

    <link href='http://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

    <script src="zepto.min.js" type="text/javascript"></script>
    <script src="utilities.js" type="text/javascript"></script>
    <script src="masterControl.js" type="text/javascript"></script>
    <script src="viewTransitions.js" type="text/javascript"></script>
    <script src="drawing.js" type="text/javascript"></script>

    <script src="Dashboard.js" type="text/javascript"></script>
    <script src="Waffle.js" type="text/javascript"></script>
    <script src="DAQ.js" type="text/javascript"></script>
    <script src="Clock.js" type="text/javascript"></script>
    <script src="Trigger.js" type="text/javascript"></script>

    <script src="tooltip.js" type="text/javascript"></script>
    <script src="alarmSidebar.js" type="text/javascript"></script>
    <script src="formHandler.js" type="text/javascript"></script>
    <script src="slider.js" type="text/javascript"></script>
    <script src="fillMeter.js" type="text/javascript"></script>
    <script src="branding.js" type="text/javascript"></script>

    <script src="BarGraph.js" type="text/javascript"></script>
    <script src="SHARC.js" type="text/javascript"></script>
    <script src="DESCANT.js" type="text/javascript"></script>
    <script src="HPGE.js" type="text/javascript"></script>
    <script src="PACES.js" type="text/javascript"></script>
    <script src="DANTE.js" type="text/javascript"></script>
    <script src="BAMBINO.js" type="text/javascript"></script>
    <script src="SCEPTAR.js" type="text/javascript"></script>
    <script src="SPICE.js" type="text/javascript"></script>


    <!--link rel="stylesheet" type="text/css" href="cssreset.css"-->
    <link rel="stylesheet" type="text/css" href="GRIFFINcc.css" />

  </head> 


  <body style="font-family: 'Raleway', sans-serif; font-size:14px; background-color:#333333; color:#FFFFFF"> 

    <!--Branding///////////////////////////////////////////////////////////-->
    <canvas id="banner"></canvas>

    <!--Top Level Navigation////////////////////////////////////////////////////////////-->
    <div id="navBar">
      <form id='statusLink' style='display:inline; position:relative; left:1%;'>
        <input class='link' type="submit" value="MIDAS Status">
        <input id='DashboardButton' class='link' type='button' value='Dashboard' onclick="javascript:swapView('DashboardLinks', 'DashboardCanvas', 'DashboardSidebar')">
        <input id='HVmonitorButton' class='link' type="button" value="HV Monitor" onclick="javascript:swapView('mainframeLinks', 'TestWaffle', 'InputLayer')">
        <input id='SubsystemsButton' class='link' type="button" value="Subsystem Monitor" onclick="javascript:swapView('SubsystemLinks', 'SHARCCanvas', 'SubsystemSidebar')">
        <input id='DAQbutton' class='link' type='button' value='DAQ' onclick="javascript:swapView('DAQlinks', 'DAQcanvas', 'DAQsidebar')">
        <input id='ClockButton' class='link' type='button' value='Clock' onclick="javascript:swapView('ClockLinks', 'ClockCanvas', 'ClockSidebar')">
        <input id='TriggerButton' class='link' type='button' value='Trigger' onclick="javascript:swapView('TriggerLinks', 'TriggerCanvas', 'TriggerSidebar')">
      </form>
      <p id="youAreHere" style='display: inline; color:rgba(255,255,255,0.3); font-size:24px; position:absolute; margin:0'></p>
    </div>

    <!--Waffleboard////////////////////////////////////////////////////////-->

    <div id="waffleplate">

      <!--Alarms//////////////////////////////////////////////////////-->
      <div class='alarmDiv' id='voltAlarm'>
        <canvas id='alarmIconV', style='position:absolute; height:150px'></canvas>
        <p id='voltageText', style='color:white; margin-left:50px; margin-right:30px; position:relative; top:150px'></p>
      </div>

      <div class='alarmDiv' id='currentAlarm'>
        <canvas id='alarmIconI', style='position:absolute; height:150px'></canvas>
        <p id='currentText', style='color:white; margin-left:50px; margin-right:30px; position:relative; top:150px'></p>
      </div>

      <div class='alarmDiv' id='tempAlarm'>
        <canvas id='alarmIconT', style='position:absolute; height:150px'></canvas>
        <p id='temperatureText', style='color:white; margin-left:50px; margin-right:30px; position:relative; top:150px'></p>
      </div>

      <!--Intra-view nav panels//////////////////////////////////////////////////////////-->
      <!--Dashboard-->
      <div id='DashboardLinks' class='navPanel', style='position:absolute; left:24%;  opacity:1; z-index:1;'>
        <h1 id='DashboardLinksBanner' style='display: inline; opacity: 0.3; font-family: "Orbitron", sans-serif; font-size: 275%; vertical-align:-20px;'>GRIFFIN Dashboard</h1>        
      </div>

      <!--HV Mainframe-->
      <div id="mainframeLinks" class='navPanel' style='position:absolute; left:24%;'>
        <h1 id='mainframeLinksBanner'  style='display: inline; opacity: 0.3; font-family: "Orbitron", sans-serif; font-size: 275%; vertical-align:-20px;'>GRIFFIN HV Mainframes</h1>
        <br><button id='Main1' class='MFlink' type="button" style='background:-webkit-gradient(linear, left top, left bottom, from(#DDDDDD), to(#FFFFFF)); background: -moz-linear-gradient(top,  #999999,  #DDDDDD);' onclick="javascript:swapFade('TestWaffle', 'Main1')">Mainframe 1</button>
        <button id='Main2' class='MFlink' type="button">Mainframe 2</button>
        <button id='Main3' class='MFlink' type="button">Mainframe 3</button>

        <br><button id='card0' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar0', 'card0')">Slot<br>0</button>
        <button id='card1' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar1', 'card1')">Slot 1</button>
        <button id='card2' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar2', 'card2')">Slot 2</button>
        <button id='card3' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar3', 'card3')">Slot<br>3</button>
        <button id='card4' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar4', 'card4')">Slot<br>4</button>
        <button id='card5' class='cardNav' type="button" style='display: inline; margin-bottom:5px;' onclick="javascript:swapFade('bar5', 'card5')">Slot 5</button>

      </div>

      <!--Subsystem Monitor-->
      <div id='SubsystemLinks' class='navPanel' style='position:absolute; left:24%;'>
        <h1 id='SubsystemLinksBanner' style='display: inline; opacity: 0.3; font-family: "Orbitron", sans-serif; font-size: 275%; vertical-align:-20px;'>GRIFFIN Subsystems</h1>

        <br><button id='SHARClink' class='MFlink' type="button" onclick="javascript:swapFade('SHARCCanvas', 'SHARClink')">SHARC</button>
        <button id='HPGElink' class='MFlink' type="button" onclick="javascript:swapFade('HPGECanvas', 'HPGElink')">HPGE</button>
        <button id='DESCANTlink' class='MFlink' type="button" onclick="javascript:swapFade('DESCANTCanvas', 'DESCANTlink')">DESCANT</button>
        <button id='PACESlink' class='MFlink' type="button" onclick="javascript:swapFade('PACESCanvas', 'PACESlink')">PACES</button>
        <button id='DANTElink' class='MFlink' type="button" onclick="javascript:swapFade('DANTECanvas', 'DANTElink')">DANTE</button>
        <button id='BAMBINOlink' class='MFlink' type="button" onclick="javascript:swapFade('BAMBINOCanvas', 'BAMBINOlink')">BAMBINO</button>
        <button id='SCEPTARlink' class='MFlink' type="button" onclick="javascript:swapFade('SCEPTARCanvas', 'SCEPTARlink')">SCEPTAR</button>
        <button id='SPICElink' class='MFlink' type="button" onclick="javascript:swapFade('SPICECanvas', 'SPICElink')">SPICE</button>

        <br><button id='SMHVlink' class='MFlink' type="button">HV</button>
        <button id='SMThresholdsLink' class='MFlink' type="button">Thresholds</button>
        <button id='RateLink' class='MFlink' type="button">Rate</button>

      </div>

      <!--DAQ-->
      <div id='DAQlinks' class='navPanel', style='position:absolute; left:24%;'>
        <h1 id='DAQlinksBanner' style='display: inline; opacity: 0.3; font-family: "Orbitron", sans-serif; font-size: 275%; vertical-align:-20px;'>GRIFFIN DAQ Status</h1> 

        <br><button id='DAQToplink' class='MFlink' type="button" onclick="javascript:swapFade('DAQcanvas', 'DAQToplink')">Top Level</button>
        <br><button id='Collector0' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector0')">Collector 00</button>
        <button id='Collector1' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector1')">Collector 01</button>
        <button id='Collector2' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector2')">Collector 02</button>
        <button id='Collector3' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector3')">Collector 03</button>
        <button id='Collector4' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector4')">Collector 04</button>
        <button id='Collector5' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector5')">Collector 05</button>
        <button id='Collector6' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector6')">Collector 06</button>
        <button id='Collector7' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector7')">Collector 07</button>
        <br><button id='Collector8' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector8')">Collector 08</button>
        <button id='Collector9' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector9')">Collector 09</button>
        <button id='Collector10' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector10')">Collector 10</button>
        <button id='Collector11' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector11')">Collector 11</button>
        <button id='Collector12' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector12')">Collector 12</button>
        <button id='Collector13' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector13')">Collector 13</button>
        <button id='Collector14' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector14')">Collector 14</button>
        <button id='Collector15' class='MFlink' type="button" onclick="javascript:swapFade('DAQdetailCanvas', 'Collector15')">Collector 15</button>
      </div>

      <!--Clock-->
      <div id='ClockLinks' class='navPanel', style='position:absolute; left:24%;'>
        <h1 id='ClockLinksBanner' style='display: inline; opacity: 0.3; font-family: "Orbitron", sans-serif; font-size: 275%; vertical-align:-20px;'>GRIFFIN Clock Status</h1>        
      </div>

      <!--Trigger-->
      <div id='TriggerLinks' class='navPanel', style='position:absolute; left:24%;'>
        <h1 id='TriggerLinksBanner' style='display: inline; opacity: 0.3; font-family: "Orbitron", sans-serif; font-size: 275%; vertical-align:-20px;'>GRIFFIN Trigger Status</h1>        
      </div>


      <!--Canvases for each central object///////////////////////////////////////////////////////-->
      <!--Dashboard-->
      <!--canvas id='DashboardCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas-->

      <!--HV-->
      <canvas id="TestWaffle" style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>

      <!--Subsystem-->
      <canvas id='SHARCCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='HPGECanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='HPGEdetailCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='DESCANTCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='DESCANTTTCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='PACESCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='DANTECanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='BAMBINOCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='SCEPTARCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>
      <canvas id='SPICECanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>

      <!--DAQ-->
      <canvas id='DAQcanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>  
      <canvas id='DAQdetailCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas>

      <!--Clock-->
      <!--canvas id='ClockCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas-->

      <!--Trigger-->
      <!--canvas id='TriggerCanvas' style='position:absolute; left:24%; opacity:0; z-index:-10000;'></canvas-->       

      <!--Right Sidebars///////////////////////////////////////////////////-->

      <canvas id='waffleSidebarBKG' style='position:absolute; z-index:-1; right:0%'> </canvas>

      <!--Sidebar for dashboard-->
      <div id='DashboardSidebar' class='Sidebar' style='opacity:1; z-index:1'>
      </div>

      <!--Sidebar for HV monitor//////////////////////////////////////////////////////-->
      <div align='left' id='InputLayer' class='Sidebar'>

        <!--title-->
        <h2 id='inputTitle' align='left' style='margin-left:10%; margin-top:25px; font-family: "Orbitron", sans-serif;'>sintitulo</h2>

        <!--Form for channel reporting and input-->
        <form id='setValues' style='margin-bottom:0px;'>
          <!--Channel on off & status:-->
          <input type='radio' id='offButton' name='HVswitch' value='off' style='margin-left:10%; margin-bottom:10px'>Off
          <input type='radio' id='onButton' name='HVswitch' value='on' style='margin-left:10px; margin-bottom:10px; display:inline;'>On

          <!--Submit updates to channel settings-->
          <input id='submitParameters' type="button" value="Commit" onclick="javascript:updateParameter()">

          <!--status:-->
          <p id='status' style='margin-left:10%;'>Status:</p>

          <!--voltage fill meter-->
          <p id='voltageMeterTitle' style='margin-left:10%; margin-bottom:0px; display:inline; position:relative; top:-18px;'>Voltage [V]</p>
          <canvas id='voltageMeter' style='margin-left:2px;' align='right'></canvas>

          <!--current fill meter-->
          <p id='currentMeterTitle' style='margin-left:10%; margin-bottom:0px; display:inline; position:relative; top:-18px;'>Current [uA]</p>
          <canvas id='currentMeter' style='margin-left:2%;' align='right'></canvas>

          <!--temperature fill meter-->
          <p id='temperatureMeterTitle' style='margin-left:10%; margin-bottom:0px; display:inline; position:relative; top:-18px;'>Temperature [C]</p>
          <canvas id='temperatureMeter' style='margin-left:2%;' align='right'></canvas>

          <!--Demand voltage input field-->
          <p id='FieldText' width='200px' style='margin-left:10%'>Demand Voltage [V]</p>
          <input type="text" id="demandVoltage" name='textbox' value='default' style='margin-bottom:10px; margin-top: 5px; margin-left:10%; margin-right:5%;' size='6'>

          <!--Slider for demand voltage-->
          <div class='slider' id='voltageSlider'>
            <canvas class='sliderBKG' id='voltageSliderBKG' height=24></canvas>
            <div class='sliderKnob' id='voltageSliderKnob'>
              <canvas class='knobStyle' id='voltageKnobStyle' width=24 height=16> </canvas>
              <p class='sliderText' id='voltageSliderText'><br>0%</p>
            </div>
          </div>

          <!--voltage ramp up speed input field-->
          <p id='RampText' width='200px' style='margin:0px; margin-left:10%; margin-top:20px;'>Voltage Ramp Up Speed [V/s]</p>
          <input type="text" id="demandRampSpeed" name='textbox' value='default' style='margin-bottom:10px; margin-top: 5px; margin-left:10%; margin-right:5%;' size='6'>

          <!--Slider for voltage ramp up speed-->
          <div class='slider' id='rampSlider'>
            <canvas class='sliderBKG' id='rampSliderBKG' height=24></canvas>
            <div class='sliderKnob' id='rampSliderKnob'>
              <canvas class='knobStyle' id='rampKnobStyle' width=24 height=16> </canvas>
              <p class='sliderText' id='rampSliderText'><br>0%</p>
            </div>
          </div>

          <!--voltage ramp down speed input field-->
          <p id='RampTextDown' width='200px' style='margin:0px; margin-left:10%; margin-top:20px;'>Voltage Ramp Down Speed [V/s]</p>
          <input type="text" id="demandRampDownSpeed" name='textbox' value='default' style='margin-bottom:30px; margin-top: 5px; margin-left:10%; margin-right:5%;' size='6'>

          <!--Slider for voltage ramp down speed-->
          <div class='slider' id='rampDownSlider'>
            <canvas class='sliderBKG' id='rampDownSliderBKG' height=24></canvas>
            <div class='sliderKnob' id='rampDownSliderKnob'>
              <canvas class='knobStyle' id='rampDownKnobStyle' width=24 height=16> </canvas>
              <p class='sliderText' id='rampDownSliderText'><br>0%</p>
            </div>
          </div>

        </form>

        <canvas id='inputSpacer' height=5px width=200px style='margin-left:10%'></canvas>
        <script type="text/JavaScript">
          //style the input layer a bit:  TODO: factor out?
          var ILcanvas = document.getElementById('inputSpacer');
          var ILcontext = ILcanvas.getContext('2d');
          ILcontext.strokeStyle = 'rgba(255,255,255,0.9)'
          ILcontext.beginPath();
          ILcontext.moveTo(0,0);
          ILcontext.lineTo(200,0);
          ILcontext.stroke();
        </script>

        <!--Form for channel selecting-->
        <form id='changeChannel'>
          <h4 style='margin-left:10%; margin-bottom:10px;'>Change Channel:</h4>
          <p style='display:inline; margin-left:10%'>Card</p>
          <!--input type="text" id="newCol" name='newCol' style='margin-bottom:10px; margin-left:5px; display:inline;' size='6' value='0'-->
          <select id='CardList' style='width:80px;'> </select>
          <br><p style='display:inline; margin-left:10%; position:relative; top:-20px;'>Channel</p>
          <!--input type="text" id="newRow" name='newRow' style='margin-bottom:10px; margin-left:5px; display:inline;' size='6' value='0'-->
          <select id='ChannelList' style='width:75px; position:relative; top:-20px;'> </select>
          <input type="button" value="Go" class='link' style='position:relative; top:-30px; width: 50px; height:50px; font-size:24px; margin-left:3%; margin-top:10px; border-color:black' id='getChannelButton'>       
        </form>

      </div>

      <!--Sidebar for subsystem monitor-->
      <div id='SubsystemSidebar' class='Sidebar'>
      </div>

      <!--Sidebar for DAQ-->
      <div id='DAQsidebar' class='Sidebar'>
      </div>

      <!--Sidebar for Clock-->
      <div id='ClockSidebar' class='Sidebar'>
      </div>

      <!--Sidebar for Trigger-->
      <div id='TriggerSidebar' class='Sidebar'>
      </div>

    </div>
  <!--End Waffleboard////////////////////////////////////////////////////-->

  <script type="text/JavaScript">

      //--------------Experiment-specific Parameters Here--------------------------------------------------
      //---------------------------------------------------------------------------------------------------
 
      //HV Monitor//////////////////////////////////////////////////////////////////////////////////////////////////
      var ODBkeys = ['/Location/Of/Device/Varibles', '/Location/Of/Device/Settings', 'Demand Voltage Key', 'Measured Voltage Key', 'Measured Current Key', 'Voltage Ramp Up Key', 'Voltage Ramp Down Key', 'Temperature Key', 'ChState Key', 'ChStatus Key', 'Voltage Limit Key', 'Current Limit Key'];

      //cell labels; first entry decribes cell type
      var rowTitles = ['Ch.', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'];

      //module names:
      var moduleLabels = ['Slot 0', 'Slot 1', 'Slot 2', 'Slot 3', 'Slot 4', 'Slot 5'];

      //alarm thresholds [voltage, current, temperature]:
      var alarmThresholds = [0.8,0.999,0.999];

      //scale maxima [voltage, current, temperature]:
      var scaleMaxima = [1,1,1];

      //tooltip info prefixes & postfixes:
      var prefix = ['Demand Voltage: ', 'Reported Voltage: ', 'Reported Current: ', 'Voltage Ramp Up Speed: ', 'Voltage Ramp Down Speed', 'Temperature: ', 'Status: '];
      var postfix = ['V', 'V', 'A', 'V/s', 'V/s', 'C', ''];

      //demand voltage range:
      var minVoltage = 0;
      var maxVoltage = 1;

      //current meter range:
      var minCurrent = 0;
      var maxCurrent = 1;

      //temperature meter range:
      var minTemperature = 0;
      var maxTemperature = 1;

      //voltage ramp speed range:
      var minRampSpeed = 0;
      var maxRampSpeed = 1;

      //number of decimal places to keep on the sliders and status pane:
      var statusPrecision = 3;
      //number of decimal places to keep on the bar chart y-axis:
      var barChartPrecision = 1;

      //voltage unit:
      var voltUnit = 'V';
      //ramp speed unit:
      var rampUnit = 'V/s';
      //current unit:
      var currentUnit = 'uA';
      //temperature unit:
      var temperatureUnit = 'C';

      //url of MIDAS status page
      var statusURL = 'http://horus.triumf.ca:8081';

      //Scalar Monitor/////////////////////////////////////////////////////////////////////////
      //rows & columns of detectors:
      var SMrows = 2;
      var SMcolumns = 4;

      //odb keys
      var SM_ODBkeys = ['/Location/Of/Device/Varibles', '/Location/Of/Device/Settings', 'HV Key'];

      //number of channels per detector:
      var SMnChannels = 16;

      //arrays of scale minima and maxima:
      var SMminima = [0];
      var SMmaxima = [1];

      //DAQ//////////////////////////////////////////////////////////////////////////////////
      var nCollectors = 16;
      var nDigitizers = 256;

      var DAQminima = [0,0,0,0,0,0,0,0,0];
      var DAQmaxima = [1,1,1,1,1,1,1,1,1];

      var configParameters = [4, 16, 16, 16*16, 16];

      //---------------End Experiment-specific parameters--------------------------------------------------
      //---------------------------------------------------------------------------------------------------

      var i,j,k;

      //autodetect what size cards are plugged into what slot:
      var moduleSizes = detectCards();

      //rows & columns:
      var rows = 12;
      var columns = 0;
      for(i=0; i<moduleSizes.length; i++){
        columns += moduleSizes[i];
        if (moduleSizes[i] == 0) columns++;
      }

      //Insert branding & navigation:
      Banner('banner', 'youAreHere', 'navBar', 'GRIFFIN HV Mainframes');

      //plug in links:
      statusLink = document.getElementById('statusLink');
      statusLink.setAttribute('action', statusURL);

      //set up wrapper div dimensions; minimum rendering width = 1440px, height 900px:
      var renderWidth = Math.max(1440, window.innerWidth);
      var renderHeight = Math.max(900*0.85,window.innerHeight*0.85)
      $('#waffleplate').width(renderWidth);
      $('#waffleplate').height(renderHeight);

      //position alarm stubs nicely:
      var alarmTop = parseFloat($('#mainframeLinksBanner').height());
      $('#voltAlarm').css('top', alarmTop);
      $('#currentAlarm').css('top', alarmTop+170);
      $('#tempAlarm').css('top', alarmTop+340);
      document.getElementById('voltAlarm').setAttribute('onclick',"javascript:alarmTransition('voltAlarm', alarmTop, alarmTop)");
      document.getElementById('currentAlarm').setAttribute('onclick',"javascript:alarmTransition('currentAlarm', alarmTop+170, alarmTop)");
      document.getElementById('tempAlarm').setAttribute('onclick',"javascript:alarmTransition('tempAlarm', alarmTop+340, alarmTop)");

      //position right sidebar nicely:
      var rightSidebarWhitespace = parseFloat(window.innerHeight*0.85) - parseFloat($('#InputLayer').height());
      $('.Sidebar').css('top', Math.min(alarmTop, 0.3*rightSidebarWhitespace) );
      $('#waffleSidebarBKG').css('top', Math.min(alarmTop, 0.3*rightSidebarWhitespace) );

      //Waffle onclick event will throw x and y positions up to these globals, so that
      //updateParameter() can use them to determine which channel to update.  TODO: fix
      //without globals.
      window.griffinDialogX;
      window.griffinDialogY;

      //set up channel navigation dropdowns:
      configureDropdowns('ChannelList', 'CardList', moduleLabels, moduleSizes);
      document.getElementById('CardList').onblur = function(event){reconfigureChannelList(moduleLabels, moduleSizes, 'ChannelList')};

      //declare objects:
      //HV monitor control sidebar elements:
      var sliderWidth = parseFloat($(document.getElementById('InputLayer')).width())*0.5;
      var sliderVoltage = new Slider('waffleSidebarBKG', 'volageSliderText', 'demandVoltage', 'voltageSlider', 'voltageSliderBKG', 'voltageSliderKnob', 'voltageKnobStyle', 'voltageSliderText', minVoltage, maxVoltage, statusPrecision, voltUnit, sliderWidth );
      var sliderRamp = new Slider('waffleSidebarBKG', 'rampSliderText', 'demandRampSpeed', 'rampSlider', 'rampSliderBKG', 'rampSliderKnob', 'rampKnobStyle', 'rampSliderText', minRampSpeed, maxRampSpeed, statusPrecision, rampUnit,  sliderWidth);
      var sliderRampDown = new Slider('waffleSidebarBKG', 'rampDownSliderText', 'demandRampDownSpeed', 'rampDownSlider', 'rampDownSliderBKG', 'rampDownSliderKnob', 'rampDownKnobStyle', 'rampDownSliderText', minRampSpeed, maxRampSpeed, statusPrecision, rampUnit,  sliderWidth);

      window.meter = new FillMeter('voltageMeter', 'InputLayer', 0, minVoltage, maxVoltage, voltUnit, statusPrecision);
      var currentMeter = new FillMeter('currentMeter', 'InputLayer', 0, minCurrent, maxCurrent, currentUnit, statusPrecision);
      var temperatureMeter = new FillMeter('temperatureMeter', 'InputLayer', 0, minTemperature, maxTemperature, temperatureUnit, statusPrecision);

      //tooltips:
      //var MFtooltip = new Tooltip('TestWaffle', 'MFTipText', 'MFTT', 'waffleplate', prefix, postfix);
      //var SubsystemTooltip = new Tooltip('SHARCCanvas', 'SubsystemTipText', 'SubsystemTT', 'waffleplate', [], []);
      //var DESCANTTooltip = new Tooltip('DESCANTCanvas', 'DESCANTTipText', 'DESCANTTT', 'waffleplate', [], []);

      //main elements
      var dashboard = new Dashboard('waffleplate');

      var waffle = new Waffle(rows,columns, alarmThresholds, scaleMaxima, "waffleplate", rowTitles, "InputLayer", ODBkeys, ['voltAlarm', 'currentAlarm', 'tempAlarm'], ['alarmIconV', 'alarmIconI', 'alarmIconT'],  'mainframeLinks', moduleSizes, moduleLabels, sliderVoltage, sliderRamp, sliderRampDown, barChartPrecision, prefix, postfix);

      var SHARCMonitor = new SHARC('waffleplate','horizontal', 'SHARCCanvas', SMrows, SMcolumns, SMnChannels, 4, 4, 1, 16, SMminima, SMmaxima, [],[]);
      var HPGEMonitor = new HPGE('waffleplate', 'HPGECanvas', 'HPGECanvas', 0);
      var DESCANTMonitor = new DESCANT('waffleplate', 'DESCANTCanvas', [],[]);
      DESCANTMonitor.wireframe();
      var PACESMonitor = new PACES('waffleplate', 'PACESCanvas');
      PACESMonitor.draw(PACESMonitor.nFrames);
      var DANTEMonitor = new DANTE('waffleplate', 'DANTECanvas');
      DANTEMonitor.draw(DANTEMonitor.nFrames);
      var BAMBINOMonitor = new BAMBINO('waffleplate', 'BAMBINOCanvas');
      BAMBINOMonitor.draw(BAMBINOMonitor.nFrames);
      var SCEPTARMonitor = new SCEPTAR('waffleplate', 'SCEPTARCanvas');
      SCEPTARMonitor.draw(SCEPTARMonitor.nFrames);
      var SPICEMonitor = new SPICE('waffleplate', 'SPICECanvas');
      SPICEMonitor.draw(SPICEMonitor.nFrames);

      var DAQMonitor = new DAQ('waffleplate', 'DAQcanvas', 'DAQdetailCanvas', 0, DAQminima, DAQmaxima, configParameters);

      var ClockMonitor = new Clock('waffleplate');
      ClockMonitor.draw(ClockMonitor.nFrames);

      var TriggerMonitor = new Trigger('waffleplate');

      //set up arrays:
      //HV monitor
      var demandVoltage, reportVoltage, reportCurrent, demandVrampUp, demandVrampDown, reportTemperature, channelMask, alarmStatus, rampStatus, voltLimit, currentLimit;
      demandVoltage = [];
      reportVoltage = [];
      reportCurrent = [];
      demandVrampUp = [];
      demandVrampDown = [];
      reportTemperature = [];
      channelMask = [];
      alarmStatus = [];
      rampStatus = [];
      voltLimit = [];
      currentLimit = [];
      for(i=0; i<rows+1; i++){
        demandVoltage[i] = [];
        reportVoltage[i] = [];
        reportCurrent[i] = [];
        demandVrampUp[i] = [];
        demandVrampDown[i] = [];
        reportTemperature[i] = [];
        channelMask[i] = [];
        alarmStatus[i] = [];
        rampStatus[i] = [];
        voltLimit[i] = [];
        currentLimit[i] = [];
        for(j=0;j<columns;j++){
          alarmStatus[i][j] = [];
        }
      }
      //scalar monitor:
      var SMHV;
      SMHV = [];
      //DAQ:
      var masterRate, masterGroupRate, masterLinkRate, collectorRate, collectorLinkRate, digiSummaryRate, digiGroupSummaryRate, digitizerLinkRate, digitizerRate;
      masterRate = [];
      masterGroupRate = [];
      masterLinkRate = [];
      collectorRate = [];
      collectorLinkRate = [];
      digiSummaryRate = [];
      digiGroupSummaryRate = [];
      digitizerLinkRate = [];
      digitizerRate = [];

      //which nav panel is on top?
      window.navOnDisplay = 'DashboardLinks';
      //which canvas is on top?
      window.onDisplay = 'DashboardCanvas';
      //which sidebar is on top?
      window.sidebarOnDisplay = 'DashboardSidebar';
      //which was the last nav button pushed?
      window.lastTrip = 'Main1';
      //should the input sidebar be refreshed?
      window.refreshInput = 1;
      //which DAQ detail is on display in the DAQ view?
      window.DAQdetail = 0;
      //something to hold the settimeout loop so it can be stopped from anywhere:
      window.loop;
      //...and similar for animation loops:
      window.animateLoop;
      window.transAnimateLoop;
      //status flag for if the Commit button is blinking on loop:
      window.commitBlink = 0;
      //hack so getMIDASindex can access these from anywhere.  TODO: fix
      window.rows = rows;
      window.moduleSizes = moduleSizes;
      //hack so this is available to the alarms easily; will remove on alarm refactor
      window.precision = statusPrecision;

      //wrap this in a function so it can be easily called to restart the loop somewhere else:
      function startLoop(){
        masterLoop(rows+1, columns, moduleSizes, ODBkeys, demandVoltage, reportVoltage, reportCurrent, demandVrampUp, demandVrampDown, reportTemperature, channelMask, alarmStatus, rampStatus, voltLimit, currentLimit, alarmThresholds, scaleMaxima, waffle, SHARCMonitor, HPGEMonitor, DESCANTMonitor, DANTEMonitor, BAMBINOMonitor, SCEPTARMonitor, SPICEMonitor, DAQMonitor, ClockMonitor, 2*(SMnChannels*SMrows*SMcolumns + 2*16), SMHV, Math.ceil(nCollectors/4), masterRate, masterGroupRate, masterLinkRate, collectorRate, collectorLinkRate, digiSummaryRate, digiGroupSummaryRate, digitizerLinkRate, digitizerRate, 0);
      }
      startLoop(); 

      $('#setValues').on('change', function(event){highlight('submitParameters')})

  </script> 
  
  </body>
 
</html>
