<html>
	<head>
	    <link id='fontLink' href='http://fonts.googleapis.com/css?family=Orbitron|Raleway' rel='stylesheet' type='text/css'>

	    <script src="zepto.min.js" type="text/javascript"></script>
	    <script src="utilities.js" type="text/javascript"></script>
	    <script src="drawing.js" type="text/javascript"></script>
	    <script src="branding.js" type="text/javascript"></script>
	    <script src="thumbnails.js" type="text/javascript"></script>

	    <link rel="stylesheet" type="text/css" href="ConfigureExperiment.css" />

	</head>

	<body style="font-family: 'Raleway', sans-serif; font-size:14px; background-color:#333333; color:#FFFFFF; text-align:center;">

		<div id='chooseExperiment', style='margin-left:auto; margin-right:auto; background:rgba(0,0,0,0.7); border: 5px solid; border-radius:10px; opacity:0; width:35%; position:relative; font-family:Orbitron; transition:opacity 0.5s; -moz-transition:opacity 0.5s; -webkit-transition:opacity 0.5s; text-align:center;'>
			<table style='margin:0 auto; width:60%;'>
				<caption style='font-size:36px'><br>Choose Your Experiment<br><br></caption>
				<tr>
					<td>
						<canvas id='GrifLogo' width='150px' height='150px'> </canvas>
					</td>
					<td>
						<canvas id='TigLogo' width='150px' height='150px'> </canvas>
					</td>
				</tr>
				<tr>
					<td style="font-size:20px;">GRIFFIN</td>
					<td style="font-size:20px;">TIGRESS</td>
				</tr>
				<tr><td><br></td></tr>
			</table>
			<br><br><br>
		</div>

		<script type='text/JavaScript'>

			//choose TIGRESS or GRIFFIN//////////////////////////////////////////////////////////////
			document.getElementById('GrifLogo').onclick = function(){
      			window.experiment = 'GRIFFIN';
      			window.subdetectors['DANTE'] = 1; //DANTE is apparently always in the corona for GRIFFIN
      			ODBSet('/DashboardConfig/topLevel/HPGeArray', 'GRIFFIN');
				document.getElementById('chooseExperiment').style.opacity = 0;
        		setTimeout(function(){
            		var element = document.getElementById('chooseExperiment');
            		element.parentNode.removeChild(element);
            		deployBanner(); 
        		}, 500);
			}

			document.getElementById('TigLogo').onclick = function(){
      			window.experiment = 'TIGRESS';
      			ODBSet('/DashboardConfig/topLevel/HPGeArray', 'TIGRESS');
				document.getElementById('chooseExperiment').style.opacity = 0;
        		setTimeout(function(){
            		var element = document.getElementById('chooseExperiment');
            		element.parentNode.removeChild(element);
            		deployBanner();            
        		}, 500);	
			}

			//insert images
			var GrifCanv = document.getElementById('GrifLogo');
			var TigCanv = document.getElementById('TigLogo');
			var GrifCtx = GrifCanv.getContext('2d');
			var TigCtx = TigCanv.getContext('2d');
			window.subdetectors = {'SHARC' : 0,
								   'HPGe' : 1,
								   'DESCANT' : 0,
								   'PACES' : 0,
								   'DANTE' : 0,
								   'BAMBINO' : 0,
								   'SCEPTAR' : 0,
								   'SPICE' : 0,
								   'TIPwall' : 0,
								   'TIPball' : 0,
								   'ZDS' : 0
								  }
			window.choices = 0;

		    var imageObj = new Image();
    		imageObj.src = 'logo.gif';
		    imageObj.onload = function() {
		      GrifCtx.drawImage(imageObj, 20, 0, imageObj.width/imageObj.height*GrifCtx.canvas.height*0.8, GrifCtx.canvas.height*0.8);
    		};

   		    var tigImage = new Image();
    		tigImage.src = 'triumf.gif';
		    tigImage.onload = function() {
		      TigCtx.drawImage(tigImage, 10, 0, tigImage.width/tigImage.height*TigCtx.canvas.height*0.8, TigCtx.canvas.height*0.8);
    		};

    		//fade initial option in
			$('#chooseExperiment').css('top', (window.innerHeight - parseFloat($('#chooseExperiment').css('height')) )*0.4  )
			document.getElementById('chooseExperiment').style.opacity = 1;
			//experiment selected///////////////////////////////////////////////////////////////////////

			function deployBanner(){
				insertDOM('canvas', 'banner', '', 'opacity:0; transition:opacity 0.5s; -moz-transition:opacity 0.5s; -webkit-transition:opacity 0.5s;', 'body', '', '');
				insertDOM('div', 'navBar', '', 'margin:none; opacity:0; transition:opacity 0.5s; -moz-transition:opacity 0.5s; -webkit-transition:opacity 0.5s; margin-bottom:100px;', 'body', '', '');
				insertDOM('p', 'youAreHere', '', 'opacity:0; display: inline; color:rgba(255,255,255,0.3); font-size:24px; margin:0; position:absolute; right:0;transition:opacity 0.5s; -moz-transition:opacity 0.5s; -webkit-transition:opacity 0.5s;', 'navBar', '','');

				//Insert branding & navigation:
        		Banner('banner', 'youAreHere', 'navBar', 'Experimental Deployment', window.experiment);

        		//deploy subsections:
        		deployChamber();
        		deployDSlampshade();
        		deployCorona();
        		deployUSlampshade();
        		if(window.experiment == 'TIGRESS') deployBeamdump();

        		//fade assets in:
        		document.getElementById('banner').style.opacity = 1;
        		document.getElementById('navBar').style.opacity = 1;
        		document.getElementById('youAreHere').style.opacity = 1;

        		setTimeout(function(){document.getElementById('Chamber').style.opacity = 1;}, 100);
        		setTimeout(function(){document.getElementById('DSlampshade').style.opacity = 1;}, 200);
        		setTimeout(function(){document.getElementById('Corona').style.opacity = 1;}, 300);
        		setTimeout(function(){document.getElementById('USlampshade').style.opacity = 1;}, 400);
        		if(window.experiment == 'TIGRESS') setTimeout(function(){document.getElementById('Beamdump').style.opacity = 1;}, 500);
        		setTimeout(function(){
        							//commit data////////////////////////////////////////////////////////////////////////
									insertDOM('button', 'writeParameters', 'button', '', 'body', function(){commitParameters()}, 'Deploy Detectors');
									document.getElementById('writeParameters').onmousedown = function(){
										$('#writeParameters').css('background-color', '#999999');
									}
									document.getElementById('writeParameters').onmouseup = function(){
										$('#writeParameters').css('background-color', '#FFFFFF');
									}
        						   }, 550)
			}

			function deployChamber(){
				var i, totalWidth; 

				totalWidth = window.innerWidth;

				insertDOM('div', 'Chamber', 'section', '', 'body', '', '');
				insertDOM('h1', 'chamberTitle', 'title', '', 'Chamber', '', 'Chamber Configuration' );

				insertDOM('table', 'chamberTable', 'sectionTable', '', 'Chamber', '', '');
				insertDOM('tr', 'chamberPicRow', '', '', 'chamberTable', '', '');
				//GRIFFIN:
				if(window.experiment == 'GRIFFIN'){
					window.leftChamber = ['SCEPTAR', 'SCEPTAR', 'PACES', 'PACES', 'SPICE', 'SPICE'];
					window.rightChamber = ['SCEPTAR', 'ZDS', 'SCEPTAR', 'ZDS', 'ZDS', 'SCEPTAR'];
					for(i=0; i<6; i++){
						insertDOM('td', 'Gcha'+i+'pic', '', '', 'chamberPicRow', '', '');
						insertDOM('canvas', 'Gcha'+i+'canv', 'thumbnail', '', 'Gcha'+i+'pic', '', '');
						document.getElementById('Gcha'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Gcha'+i+'canv').thumb = i;
						document.getElementById('Gcha'+i+'canv').chosen = 0;

						thumbnail('Gcha'+i+'canv', window.leftChamber[i], window.rightChamber[i], '#999999');

						document.getElementById('Gcha'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftChamber[this.thumb], window.rightChamber[this.thumb], '#FFFFFF');
						}
						document.getElementById('Gcha'+i+'canv').onmouseout = function() {
							if(this.chosen==0)thumbnail(this.id, window.leftChamber[this.thumb], window.rightChamber[this.thumb], '#999999');
						}

						document.getElementById('Gcha'+i+'canv').onclick = function(){clickBehavior.call(this, 6, 'Gcha', window.leftChamber, window.rightChamber)};

					}

				}

				//TIGRESS:
				if(window.experiment == 'TIGRESS'){
					window.leftChamber = ['BAMBINO', 'none', 'BAMBINO', 'SHARC', 'TIPwall', 'TIPball'];
					window.rightChamber = ['solo', 'BAMBINO', 'BAMBINO', 'none', 'none', 'none'];
					for(i=0; i<6; i++){
						insertDOM('td', 'Tcha'+i+'pic', '', '', 'chamberPicRow', '', '');
						insertDOM('canvas', 'Tcha'+i+'canv', 'thumbnail', '', 'Tcha'+i+'pic', '', '');
						document.getElementById('Tcha'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Tcha'+i+'canv').thumb = i;
						document.getElementById('Tcha'+i+'canv').chosen = 0;

						thumbnail('Tcha'+i+'canv', window.leftChamber[i], window.rightChamber[i], '#999999');

						document.getElementById('Tcha'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftChamber[this.thumb], window.rightChamber[this.thumb], '#FFFFFF');
						}
						document.getElementById('Tcha'+i+'canv').onmouseout = function() {
							if(this.chosen==0)thumbnail(this.id, window.leftChamber[this.thumb], window.rightChamber[this.thumb], '#999999');
						}

						document.getElementById('Tcha'+i+'canv').onclick = function(){clickBehavior.call(this, 6, 'Tcha', window.leftChamber, window.rightChamber)};

					}

				}
			}

			function deployDSlampshade(){
				var i, totalWidth; 

				totalWidth = window.innerWidth;

				insertDOM('div', 'DSlampshade', 'section', '', 'body', '', '');
				insertDOM('h1', 'deLampshadeTitle', 'title', '', 'DSlampshade', '', 'Downstream Lampshade Configuration' );

				insertDOM('table', 'dsLampTable', 'sectionTable', '', 'DSlampshade', '', '');
				insertDOM('tr', 'dsLampPicRow', '', '', 'dsLampTable', '', '');
				//insertDOM('tr', 'dsLampRadioRow', '', '', 'dsLampTable', '', '');
				//GRIFFIN:
				if(window.experiment == 'GRIFFIN'){
					window.leftDSL = ['GRIFFIN', 'GRIFFIN'];
					window.rightDSL = ['none', 'DESCANT'];
					for(i=0; i<2; i++){
						insertDOM('td', 'Gdsl'+i+'pic', '', '', 'dsLampPicRow', '', '');
						insertDOM('canvas', 'Gdsl'+i+'canv', 'thumbnail', '', 'Gdsl'+i+'pic', '', '');
						document.getElementById('Gdsl'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Gdsl'+i+'canv').thumb = i;
						document.getElementById('Gdsl'+i+'canv').chosen = 0;

						thumbnail('Gdsl'+i+'canv', window.leftDSL[i], window.rightDSL[i], '#999999');

						document.getElementById('Gdsl'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftDSL[this.thumb], window.rightDSL[this.thumb], '#FFFFFF');
						}
						document.getElementById('Gdsl'+i+'canv').onmouseout = function() {
							if(this.chosen == 0)thumbnail(this.id, window.leftDSL[this.thumb], window.rightDSL[this.thumb], '#999999');
						}

						document.getElementById('Gdsl'+i+'canv').onclick = function(){clickBehavior.call(this, 2, 'Gdsl', window.leftDSL, window.rightDSL)};
					}
				}
				//TIGRESS:
				if(window.experiment == 'TIGRESS'){
					window.leftDSL = ['TIGRESS', 'TIGRESS', 'TIGRESS', 'TIGRESS'];
					window.rightDSL = ['none', 'SHARC', 'DESCANT', 'all'];
					for(i=0; i<4; i++){
						insertDOM('td', 'Tdsl'+i+'pic', '', '', 'dsLampPicRow', '', '');
						insertDOM('canvas', 'Tdsl'+i+'canv', 'thumbnail', '', 'Tdsl'+i+'pic', '', '');
						document.getElementById('Tdsl'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Tdsl'+i+'canv').thumb = i;
						document.getElementById('Tdsl'+i+'canv').chosen = 0;

						thumbnail('Tdsl'+i+'canv', window.leftDSL[i], window.rightDSL[i], '#999999');

						document.getElementById('Tdsl'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftDSL[this.thumb], window.rightDSL[this.thumb], '#FFFFFF');
						}
						document.getElementById('Tdsl'+i+'canv').onmouseout = function() {
							if(this.chosen == 0)thumbnail(this.id, window.leftDSL[this.thumb], window.rightDSL[this.thumb], '#999999');
						}

						document.getElementById('Tdsl'+i+'canv').onclick = function(){clickBehavior.call(this, 4, 'Tdsl', window.leftDSL, window.rightDSL)};
					}
				}
			}

			function deployCorona(){
				var i, totalWidth; 

				totalWidth = window.innerWidth;

				insertDOM('div', 'Corona', 'section', '', 'body', '', '');
				insertDOM('h1', 'coronaTitle', 'title', '', 'Corona', '', 'Corona Configuration' );

				insertDOM('table', 'coronaTable', 'sectionTable', '', 'Corona', '', '');
				insertDOM('tr', 'coronaPicRow', '', '', 'coronaTable', '', '');
				//GRIFFIN:
				if(window.experiment == 'GRIFFIN'){
					window.leftCor = ['GRIFFIN'];
					window.rightCor = ['DANTE'];	
					for(i=0; i<1; i++){
						insertDOM('td', 'Gcor'+i+'pic', '', '', 'coronaPicRow', '', '');
						insertDOM('canvas', 'Gcor'+i+'canv', 'thumbnail', '', 'Gcor'+i+'pic', '', '');
						document.getElementById('Gcor'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Gcor'+i+'canv').thumb = i;
						document.getElementById('Gcor'+i+'canv').chosen = 0;				

						thumbnail('Gcor'+i+'canv', window.leftCor[i], window.rightCor[i], '#FFFFFF');

						document.getElementById('Gcor'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftCor[this.thumb], window.rightCor[this.thumb], '#FFFFFF');
						}
						//document.getElementById('Gcor'+i+'canv').onmouseout = function() {
						//	if(this.chosen == 0)thumbnail(this.id, window.leftCor[this.thumb], window.rightCor[this.thumb], '#999999');
						//}

						//document.getElementById('Gcor'+i+'canv').onclick = function(){clickBehavior.call(this, 2, 'Gcor', window.leftCor, window.rightCor)};						
					}
				}
				//TIGRESS:
				if(window.experiment == 'TIGRESS'){
					window.leftCor = ['TIGRESS'];
					window.rightCor = ['none'];	
					for(i=0; i<1; i++){
						insertDOM('td', 'Tcor'+i+'pic', '', '', 'coronaPicRow', '', '');
						insertDOM('canvas', 'Tcor'+i+'canv', 'thumbnail', '', 'Tcor'+i+'pic', '', '');
						document.getElementById('Tcor'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Tcor'+i+'canv').thumb = i;
						document.getElementById('Tcor'+i+'canv').chosen = 0;				

						thumbnail('Tcor'+i+'canv', window.leftCor[i], window.rightCor[i], '#FFFFFF');

						document.getElementById('Tcor'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftCor[this.thumb], window.rightCor[this.thumb], '#FFFFFF');
						}
						//document.getElementById('Gcor'+i+'canv').onmouseout = function() {
						//	if(this.chosen == 0)thumbnail(this.id, window.leftCor[this.thumb], window.rightCor[this.thumb], '#999999');
						//}

						//document.getElementById('Tcor'+i+'canv').onclick = function(){clickBehavior.call(this, 2, 'Tcor', window.leftCor, window.rightCor)};						
					}
				}
			}

			function deployUSlampshade(){
				var i, totalWidth; 

				totalWidth = window.innerWidth;

				insertDOM('div', 'USlampshade', 'section', '', 'body', '', '');
				insertDOM('h1', 'USlampshadeTitle', 'title', '', 'USlampshade', '', 'Upstream Lampshade Configuration' );

				insertDOM('table', 'usLampTable', 'sectionTable', '', 'USlampshade', '', '');
				insertDOM('tr', 'usLampPicRow', '', '', 'usLampTable', '', '');
				//insertDOM('tr', 'usLampRadioRow', '', '', 'usLampTable', '', '');
				//GRIFFIN:
				if(window.experiment == 'GRIFFIN'){
					window.leftUSL = ['GRIFFIN', 'GRIFFIN'];
					window.rightUSL = ['none', 'SPICE'];
					for(i=0; i<2; i++){
						insertDOM('td', 'Gusl'+i+'pic', '', '', 'usLampPicRow', '', '');
						insertDOM('canvas', 'Gusl'+i+'canv', 'thumbnail', '', 'Gusl'+i+'pic', '', '');
						document.getElementById('Gusl'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Gusl'+i+'canv').thumb = i;	
						document.getElementById('Gusl'+i+'canv').chosen = 0;

						thumbnail('Gusl'+i+'canv', window.leftUSL[i], window.rightUSL[i], '#999999');

						document.getElementById('Gusl'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftUSL[this.thumb], window.rightUSL[this.thumb], '#FFFFFF');
						}
						document.getElementById('Gusl'+i+'canv').onmouseout = function() {
							if(this.chosen == 0)thumbnail(this.id, window.leftUSL[this.thumb], window.rightUSL[this.thumb], '#999999');
						}

						document.getElementById('Gusl'+i+'canv').onclick = function(){clickBehavior.call(this, 2, 'Gusl', window.leftUSL, window.rightUSL)};	

					}
				}
				//TIGRESS:
				if(window.experiment == 'TIGRESS'){
					window.leftUSL = ['TIGRESS', 'TIGRESS'];
					window.rightUSL = ['none', 'SPICE'];
					for(i=0; i<2; i++){
						insertDOM('td', 'Tusl'+i+'pic', '', '', 'usLampPicRow', '', '');
						insertDOM('canvas', 'Tusl'+i+'canv', 'thumbnail', '', 'Tusl'+i+'pic', '', '');
						document.getElementById('Tusl'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Tusl'+i+'canv').thumb = i;	
						document.getElementById('Tusl'+i+'canv').chosen = 0;

						thumbnail('Tusl'+i+'canv', window.leftUSL[i], window.rightUSL[i], '#999999');

						document.getElementById('Tusl'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftUSL[this.thumb], window.rightUSL[this.thumb], '#FFFFFF');
						}
						document.getElementById('Tusl'+i+'canv').onmouseout = function() {
							if(this.chosen == 0)thumbnail(this.id, window.leftUSL[this.thumb], window.rightUSL[this.thumb], '#999999');
						}

						document.getElementById('Tusl'+i+'canv').onclick = function(){clickBehavior.call(this, 2, 'Tusl', window.leftUSL, window.rightUSL)};	

					}
				}
			}

			function deployBeamdump(){
				var i, totalWidth; 

				totalWidth = window.innerWidth;

				insertDOM('div', 'Beamdump', 'section', '', 'body', '', '');
				insertDOM('h1', 'beamdumpTitle', 'title', '', 'Beamdump', '', 'Beamdump Configuration' );

				insertDOM('table', 'beamdumpTable', 'sectionTable', '', 'Beamdump', '', '');
				insertDOM('tr', 'beamdumpPicRow', '', '', 'beamdumpTable', '', '');
				//insertDOM('tr', 'beamdumpRadioRow', '', '', 'beamdumpTable', '', '');
				//GRIFFIN:

				//TIGRESS:
				if(window.experiment == 'TIGRESS'){
					window.leftBDP = ['beamdump'];
					window.rightBDP = ['none'];
					for(i=0; i<1; i++){
						insertDOM('td', 'Tbdp'+i+'pic', '', '', 'beamdumpPicRow', '', '');
						insertDOM('canvas', 'Tbdp'+i+'canv', 'thumbnail', '', 'Tbdp'+i+'pic', '', '');
						document.getElementById('Tbdp'+i+'canv').setAttribute('width', 0.9*totalWidth/6);
						document.getElementById('Tbdp'+i+'canv').thumb = i;	
						document.getElementById('Tbdp'+i+'canv').chosen = 0;

						thumbnail('Tbdp'+i+'canv', window.leftBDP[i], window.rightBDP[i], '#FFFFFF');

						document.getElementById('Tbdp'+i+'canv').onmouseover = function() {
							thumbnail(this.id, window.leftBDP[this.thumb], window.rightBDP[this.thumb], '#FFFFFF');
						}
						///document.getElementById('Tbdp'+i+'canv').onmouseout = function() {
						///	if(this.chosen == 0)thumbnail(this.id, window.leftBDP[this.thumb], window.rightBDP[this.thumb], '#999999');
						///}

						//document.getElementById('Tbdp'+i+'canv').onclick = function(){clickBehavior.call(this, 2, 'Tbdp', window.leftBDP, window.rightBDP)};	

					}
				}
			}

			function clickBehavior(nFigures, prefix, det1, det2){
				if(this.chosen == 0){
					$('#'+this.id).css('left', window.innerWidth/2 - parseFloat(this.width)/2 - document.getElementById(this.id).getBoundingClientRect().left  );
					$('#'+this.id).css('z-index', 1);
					for(var i=0; i<nFigures; i++){
						if(i != this.thumb){
							document.getElementById(prefix+i+'canv').style.opacity = 0;
							document.getElementById(prefix+i+'canv').setAttribute('z-index', -1);
						}
					}

					window.subdetectors[det1[this.thumb]]++;
					window.subdetectors[det2[this.thumb]]++;
					if(det2[this.thumb] == 'all'){
						window.subdetectors['SHARC']++;
						window.subdetectors['DESCANT']++;
					}
					window.choices++;

					this.chosen = 1;
				} else{
					$('#'+this.id).css('left', 0);
					$('#'+this.id).css('z-index', 0);
					for(var i=0; i<nFigures; i++){
						if(i != this.thumb){ 
							document.getElementById(prefix+i+'canv').style.opacity = 1;
							document.getElementById(prefix+i+'canv').setAttribute('z-index', 0);
						}
					}

					window.subdetectors[det1[this.thumb]]--;
					window.subdetectors[det2[this.thumb]]--;
					window.choices--;

					this.chosen = 0;
				}
			}

			function commitParameters(){
				if(window.choices < 3){
					alert('Please click on a deployment option for all sectors.')
				} else{
					for (var key in window.subdetectors){
						if(key == 'TIPwall' || key == 'TIPball'){
							if(window.subdetectors['TIPwall']==1 || window.subdetectors['TIPball']==1)
								ODBSet('/DashboardConfig/TIP/deploy', 1);
							else 
								ODBSet('/DashboardConfig/TIP/deploy', 0);

							if(window.subdetectors['TIPwall'] == 1)
								ODBSet('/DashboardConfig/TIP/mode', 'wall');
							else if(window.subdetectors['TIPball'] == 1)
								ODBSet('/DashboardConfig/TIP/mode', 'ball');
							else 
								ODBSet('/DashboardConfig/TIP/mode', '');
						} else
							ODBSet('/DashboardConfig/'+key+'/deploy', window.subdetectors[key]);
					}

					window.location = 'http://alphadon.triumf.ca:8082/CS/ConfigureSubdetectors';
				}
			}

		</script>

	</body>
</html>